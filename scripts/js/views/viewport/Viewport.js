// Generated by CoffeeScript 1.4.0
(function() {

  define(["collections/ViewportTiles", "views/viewport/ViewportTile", "models/Viewport", "models/Heightmap", "Alea", "Backbone"], function(viewportTiles, ViewportTileView, viewportModel, heightmapModel) {
    var ViewportView;
    return ViewportView = Backbone.View.extend({
      el: ".map-viewport",
      initialize: function() {
        this.rnd = new Alea(heightmapModel.get("SEED"));
        this.render();
        return this.listenTo(viewportModel, "moved", this.onViewportMoved);
      },
      render: function() {
        var _this = this;
        this.$el.css({
          width: viewportModel.get("width") * 16,
          height: viewportModel.get("height") * 16
        });
        this.grid = [];
        viewportTiles.each(function(viewportTileModel) {
          var viewportTileView;
          viewportTileView = new ViewportTileView;
          viewportTileView.setModel(viewportTileModel);
          _this.$el.append(viewportTileView.render().$el);
          return _this.grid.push(viewportTileView);
        });
        return this;
      },
      onViewportMoved: function() {
        $(".creature-moving").removeClass("creature-moving");
        clearTimeout(this.timeout);
        return _.each(this.grid, function(viewportTileView, index) {
          return viewportTileView.setModel(viewportTiles.at(index));
        });
      }
    });
  });

}).call(this);
